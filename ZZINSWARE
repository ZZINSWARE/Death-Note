local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "ZZINSWARE V3 | Death Note",
    Folder = "ZZINSWARE",
    OpenButton = {Enabled = false},
    Watermark = {Enabled = false},
    HideSearchBar = true
})

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local DetectionActive = false
local KiraList, TakaList, LList = {}, {}, {}
local NoclipConnection = nil
local AutoFishConnection = nil

local ESPEnabled = false
local KiraESPEnabled = false
local ObjectESP = {DeathNote = false, IDs = false, YourID = false}
local Highlights = {}

local GameFolder = ReplicatedStorage:WaitForChild("Game", 10)
local Timer = GameFolder and GameFolder:FindFirstChild("Timer")
local GamePhase = GameFolder and GameFolder:FindFirstChild("GamePhase")

local function formatName(p)
    local d = p.DisplayName:sub(1,12); if #p.DisplayName > 12 then d = d.."..." end
    local n = p.Name:sub(1,10); if #p.Name > 10 then n = n.."..." end
    return d.." ("..n..")"
end

local MainTab = Window:Tab({Title = "Main", Icon = "home"})
local ESPTab = Window:Tab({Title = "ESP", Icon = "eye"})
local SettingsTab = Window:Tab({Title = "Settings", Icon = "settings"})
local InfoTab = Window:Tab({Title = "Info", Icon = "info"})

local StatusLabel = MainTab:Paragraph({Title = "Status", Desc = "Ready"})
local KiraLabel   = MainTab:Paragraph({Title = "Kira", Desc = "None"})
local IDLabel     = MainTab:Paragraph({Title = "ID Takers", Desc = "None"})
local LLabel      = MainTab:Paragraph({Title = "L", Desc = "None"})
local StatsLabel  = MainTab:Paragraph({Title = "Stats", Desc = "K:0 | ID:0 | L:0"})

-- FULL DETECTION (2025 working)
local function RunDetection()
    while DetectionActive do
        task.wait(1)
        KiraList, TakaList, LList = {}, {}, {}

        -- Kira Detection
        for _, plr in Players:GetPlayers() do
            if plr.Character then
                if plr.Character:FindFirstChildWhichIsA("Tool") and plr.Character:FindFirstChildWhichIsA("Tool").Name:find("Death") then
                    table.insert(KiraList, plr)
                end
            end
            if plr:FindFirstChild("Backpack") then
                if plr.Backpack:FindFirstChildWhichIsA("Tool") and plr.Backpack:FindFirstChildWhichIsA("Tool").Name:find("Death") then
                    table.insert(KiraList, plr)
                end
            end
        end

        -- ID Takers
        local map = Workspace:FindFirstChild("Map")
        if map then
            for _, obj in map:GetDescendants() do
                local gui = obj:FindFirstChildWhichIsA("SurfaceGui") or obj:FindFirstChildWhichIsA("BillboardGui")
                if gui and gui.Enabled then
                    for _, txt in gui:GetDescendants() do
                        if txt:IsA("TextLabel") then
                            for _, plr in Players:GetPlayers() do
                                if txt.Text:find(plr.DisplayName) or txt.Text:find(plr.Name) then
                                    table.insert(TakaList, plr)
                                end
                            end
                        end
                    end
                end
            end
        end

        -- L Detection
        local highest = -1
        for _, plr in Players:GetPlayers() do
            if table.find(KiraList, plr) or table.find(TakaList, plr) then continue end
            local val = plr:FindFirstChild("LChance_Weight") or plr:FindFirstChild("LChance")
            if val and val.Value > highest then
                highest = val.Value
                LList = {plr}
            elseif val and val.Value == highest then
                table.insert(LList, plr)
            end
        end

        -- Update Labels
        KiraLabel:SetDesc(#KiraList>0 and table.concat((function() local t={} for _,p in KiraList do table.insert(t,formatName(p)) end return t end)()," | ") or "None")
        IDLabel:SetDesc(#TakaList>0 and table.concat((function() local t={} for _,p in TakaList do table.insert(t,formatName(p)) end return t end)()," | ") or "None")
        LLabel:SetDesc(#LList>0 and table.concat((function() local t={} for _,p in LList do table.insert(t,formatName(p)) end return t end)()," | ") or "None")
        StatsLabel:SetDesc("K:"..#KiraList.." | ID:"..#TakaList.." | L:"..#LList)
    end
end

MainTab:Button({Title = "Start Detection", Callback = function()
    if DetectionActive then return end
    if not Workspace:FindFirstChild("Map") then WindUI:Notify({Title="Error", Content="Wait for map"}); return end
    DetectionActive = true
    StatusLabel:SetDesc("Active")
    task.spawn(RunDetection)
end})

MainTab:Button({Title = "Stop Detection", Callback = function()
    DetectionActive = false
    StatusLabel:SetDesc("Stopped")
    KiraList,TakaList,LList = {},{},{}
end})

MainTab:Toggle({Title = "Noclip", Locked = false, Callback = function(v)
    if v then
        NoclipConnection = RunService.Stepped:Connect(function()
            for _,p in LocalPlayer.Character:GetDescendants() do
                if p:IsA("BasePart") then p.CanCollide = false end
            end
        end)
    else
        if NoclipConnection then NoclipConnection:Disconnect() end
    end
end})

MainTab:Toggle({Title = "Auto Fish (Spam)", Locked = false, Callback = function(v)
    if v then
        AutoFishConnection = RunService.Heartbeat:Connect(function()
            pcall(function()
                ReplicatedStorage.Remotes.MinigameEvent:FireServer({Status = "CaughtFish"})
            end)
        end)
        WindUI:Notify({Title="Auto Fish", Content="ON"})
    else
        if AutoFishConnection then AutoFishConnection:Disconnect() end
        WindUI:Notify({Title="Auto Fish", Content="OFF"})
    end
end})

MainTab:Button({Title = "TP to Your ID", Callback = function()
    local map = Workspace:FindFirstChild("Map")
    if map then
        for _, obj in map:GetDescendants() do
            local gui = obj:FindFirstChildWhichIsA("SurfaceGui")
            if gui and gui.Enabled then
                for _, txt in gui:GetDescendants() do
                    if txt:IsA("TextLabel") and (txt.Text == LocalPlayer.DisplayName or txt.Text == LocalPlayer.Name) then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = obj.CFrame + Vector3.new(0,5,0)
                    end
                end
            end
        end
    end
end})

ESPTab:Toggle({Title = "Player ESP", Locked = false, Callback = function(v)
    ESPEnabled = v
    for _,h in Highlights do h:Destroy() end
    Highlights = {}
    if v then
        spawn(function()
            while ESPEnabled do
                for _,h in Highlights do if h and h.Parent then h:Destroy() end end
                Highlights = {}
                for _, plr in Players:GetPlayers() do
                    if plr ~= LocalPlayer and plr.Character then
                        local hl = Instance.new("Highlight", plr.Character)
                        hl.FillTransparency = 0.5
                        if table.find(KiraList, plr) then hl.FillColor = Color3.new(1,0,0)
                        elseif table.find(TakaList, plr) then hl.FillColor = Color3.new(0,0,1)
                        else hl.FillColor = Color3.new(1,1,1) end
                        table.insert(Highlights, hl)
                    end
                end
                task.wait(1)
            end
        end)
    end
end})

SettingsTab:Keybind({Title = "Toggle UI", Value = "K", Callback = function() Window:Toggle() end})

InfoTab:Paragraph({Title = "ZZINSWARE V3", Desc = "Fully working 2025\nby zzins\nWindUI • Mobile safe"})
InfoTab:Button({Title = "Copy Discord", Callback = function()
    setclipboard("https://discord.gg/clanker")
    WindUI:Notify({Title="Copied", Content="discord.gg/clanker"})
end})

WindUI:Notify({Title = "ZZINSWARE V3", Content = "Loaded • Press K", Duration = 10})
